<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pitfall! Basic, Multi-Level</title>
  <style>
    canvas { background: #222; display: block; margin: 30px auto; }
    body { color: #fff; background: #222; font-family: sans-serif; text-align: center;}
  </style>
</head>
<body>
  <h2>Pitfall! (Super Basic Shapes)</h2>
  <p id="levelDisplay"></p>
  <p id="scoreDisplay"></p>
  <canvas id="gameCanvas" width="800" height="400"></canvas>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const levelDisplay = document.getElementById('levelDisplay');
    const scoreDisplay = document.getElementById('scoreDisplay');

    // Player properties - simple circle
    let player = {
      x: 60,
      y: 350,
      radius: 18,
      color: '#fff',
      vx: 0,
      vy: 0,
      onGround: true
    };

    // Game state
    let level = 0;
    let levels = [];
    let score = 0;
    let gameOver = false;

    // Gravity and movement
    const gravity = 1;
    const jumpStrength = -15;
    const moveSpeed = 6;

    // Level definitions
    function makeLevel(obstacles, enemies, treasures) {
      return { obstacles, enemies, treasures };
    }

    // Each enemy moves horizontally between minX and maxX
    function makeEnemy(x, y, width, height, color, minX, maxX, speed) {
      return {x, y, width, height, color, minX, maxX, speed, direction: 1};
    }

    // Level layouts
    levels.push(
      // Level 1 - Simple
      makeLevel(
        [
          {x: 250, y: 370, width: 80, height: 18, color: 'brown'}, // log
          {x: 400, y: 370, width: 60, height: 18, color: 'green'}, // bush
          {x: 550, y: 370, width: 80, height: 10, color: 'black'}  // pit
        ],
        [
          makeEnemy(350, 350, 40, 20, 'red', 320, 500, 2)
        ],
        [
          {x: 750, y: 320, width: 18, height: 18, color: 'gold'}
        ]
      )
    );

    levels.push(
      // Level 2 - Harder
      makeLevel(
        [
          {x: 200, y: 370, width: 60, height: 18, color: 'brown'},
          {x: 300, y: 370, width: 80, height: 10, color: 'black'},
          {x: 420, y: 370, width: 60, height: 18, color: 'green'},
          {x: 520, y: 370, width: 80, height: 18, color: 'brown'}
        ],
        [
          makeEnemy(250, 350, 40, 20, 'red', 220, 380, 3),
          makeEnemy(600, 350, 40, 20, 'red', 570, 700, 2)
        ],
        [
          {x: 700, y: 320, width: 18, height: 18, color: 'gold'},
          {x: 760, y: 320, width: 18, height: 18, color: 'gold'}
        ]
      )
    );

    levels.push(
      // Level 3 - Challenge
      makeLevel(
        [
          {x: 180, y: 370, width: 40, height: 18, color: 'brown'},
          {x: 260, y: 370, width: 80, height: 10, color: 'black'},
          {x: 400, y: 370, width: 60, height: 18, color: 'green'},
          {x: 500, y: 370, width: 80, height: 10, color: 'black'},
          {x: 650, y: 370, width: 80, height: 18, color: 'brown'}
        ],
        [
          makeEnemy(200, 350, 40, 20, 'red', 180, 320, 4),
          makeEnemy(430, 350, 40, 20, 'red', 400, 600, 3),
          makeEnemy(700, 350, 40, 20, 'red', 650, 780, 2)
        ],
        [
          {x: 780, y: 320, width: 18, height: 18, color: 'gold'}
        ]
      )
    );

    function resetPlayer() {
      player.x = 60;
      player.y = 350;
      player.vx = 0;
      player.vy = 0;
    }

    function drawPlayer() {
      ctx.beginPath();
      ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
      ctx.fillStyle = player.color;
      ctx.fill();
      ctx.closePath();
    }

    function drawObstacles(obstacles) {
      obstacles.forEach(obj => {
        ctx.fillStyle = obj.color;
        ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
      });
    }

    function drawTreasures(treasures) {
      treasures.forEach(obj => {
        ctx.fillStyle = obj.color;
        ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
      });
    }

    function drawEnemies(enemies) {
      enemies.forEach(enemy => {
        ctx.fillStyle = enemy.color;
        ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
      });
    }

    function drawGround() {
      ctx.fillStyle = "#444";
      ctx.fillRect(0, 370, canvas.width, 30);
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawGround();
      drawPlayer();
      drawObstacles(levels[level].obstacles);
      drawEnemies(levels[level].enemies);
      drawTreasures(levels[level].treasures);
    }

    function updatePlayer() {
      player.x += player.vx;
      player.y += player.vy;

      // Gravity
      if (!player.onGround) {
        player.vy += gravity;
      }

      // Ground collision
      if (player.y + player.radius >= 370) {
        player.y = 370 - player.radius;
        player.vy = 0;
        player.onGround = true;
      } else {
        player.onGround = false;
      }

      // Keep player in bounds
      if (player.x - player.radius < 0) player.x = player.radius;
      if (player.x + player.radius > canvas.width) player.x = canvas.width - player.radius;
    }

    // Simple collision with obstacles (horizontal only)
    function checkCollisions() {
      // Obstacles
      levels[level].obstacles.forEach(obj => {
        if (
          player.x + player.radius > obj.x &&
          player.x - player.radius < obj.x + obj.width &&
          player.y + player.radius > obj.y &&
          player.y - player.radius < obj.y + obj.height
        ) {
          score -= 10;
          resetPlayer();
        }
      });

      // Enemies
      levels[level].enemies.forEach(enemy => {
        if (
          player.x + player.radius > enemy.x &&
          player.x - player.radius < enemy.x + enemy.width &&
          player.y + player.radius > enemy.y &&
          player.y - player.radius < enemy.y + enemy.height
        ) {
          score -= 20;
          resetPlayer();
        }
      });

      // Treasures
      levels[level].treasures.forEach((obj, idx, arr) => {
        if (
          player.x + player.radius > obj.x &&
          player.x - player.radius < obj.x + obj.width &&
          player.y + player.radius > obj.y &&
          player.y - player.radius < obj.y + obj.height
        ) {
          score += 50;
          arr.splice(idx, 1); // Remove collected treasure
        }
      });
    }

    function checkLevelAdvance() {
      // If player reaches far right and treasures are collected, go to next level
      if (player.x + player.radius >= canvas.width - 10 && levels[level].treasures.length === 0) {
        level++;
        if (level >= levels.length) {
          gameOver = true;
        } else {
          resetPlayer();
        }
      }
    }

    function updateEnemies() {
      levels[level].enemies.forEach(enemy => {
        enemy.x += enemy.speed * enemy.direction;
        if (enemy.x < enemy.minX || enemy.x + enemy.width > enemy.maxX) {
          enemy.direction *= -1;
        }
      });
    }

    function gameLoop() {
      if (gameOver) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#fff";
        ctx.font = "32px sans-serif";
        ctx.fillText("You Win! Final Score: " + score, 220, 200);
        return;
      }

      updatePlayer();
      updateEnemies();
      checkCollisions();
      checkLevelAdvance();
      draw();
      levelDisplay.textContent = "Level: " + (level + 1) + " / " + levels.length;
      scoreDisplay.textContent = "Score: " + score;
      requestAnimationFrame(gameLoop);
    }

    // Controls
    window.addEventListener('keydown', function(e) {
      if (e.key === 'ArrowLeft') player.vx = -moveSpeed;
      if (e.key === 'ArrowRight') player.vx = moveSpeed;
      if ((e.key === ' ' || e.key === 'ArrowUp') && player.onGround) {
        player.vy = jumpStrength;
        player.onGround = false;
      }
    });

    window.addEventListener('keyup', function(e) {
      if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') player.vx = 0;
    });

    // Start the game
    gameLoop();
  </script>
</body>
</html>
